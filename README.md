# highload_zoom

## Содержание
  #### [1. Тема и целевая аудитория](#1-тема-и-целевая-аудитория)
  #### [2. Расчет нагрузки](#2-расчет-нагрузки)
  #### [Источники](#источники)

## 1. Тема и целевая аудитория



### Тема
Zoom - платформа для видеоконференций.

### MVP
- Проведение/просмотр видеоконференции
- Отправка/просмотр сообщений в чате 
- Запись конференций и хранение в облаке


### Целевая аудитория  
- Весь мир.
- Пользователи:
	-  MAU 850 млн \[[1]( https://www.semrush.com/website/zoom.us/overview/)]
	-  DAU 300 млн \[[2](https://www.searchlogistics.com/learn/statistics/zoom-user-statistics/)]
- Распределение аудитории по странам \[[3](https://www.statista.com/statistics/1259936/distribution-of-zoomus-traffic-by-country/)]
  - США - 41%
  - Япония - 4.4%
  - Индия - 4.3%
  - Канада - 3.9%
  - Великобритания - 3.7%
  - Другие - 42.5%

### Продуктовые метрики
- 3.3 трлн. минут конференций в год [[4](https://www.demandsage.com/zoom-statistics/)] 
- 45 минут  - средняя продолжительность конференции \[[5](https://teamstage.io/zoom-statistics/)]

## 2. Расчет нагрузки

### Продуктовые метрики

| Метрика                                      | Значение |
| -------------------------------------------- | -------- |
| Месячная аудитория                           | 800 млн  |
| Суточная аудитория                           | 350 млн  |
| Сообщений в день                             | 1.4 млрд   |
| Суммарная длительность конференций в год                            | 3.3 трлн мин   |
| Суммарная длительность конференций в день                            | 150.6 млн часов   |
| Средняя длительность конференции                             | 45 мин  |
| Конференций в день                             | 208 млн   |





### Технические метрики

#### Сетевой трафик
1. Проведение конференции

   - Дневная нагрузка:
     Средняя суммарная длительность всех трансляций за один день — 150.6 млн часов. Для видео в качестве 1080p и частотой обновления обновления 30 fps, битрейт варьируется от 1.2 до 3 Mbps в зависимости от пропускной способности сети. Будем считать что битрейт 3 Mbps = 3000 Kbps. Для передачи звука возьмем битрейт 160 Kbps.

     $3160 \times 60 \times 60 \times 150.6  \times 10^{6}     \approx 1.71 \times 10^{15} \ \text{кбит в сутки} \approx 204 \text{ ПБайт/сутки}$

   - Пиковая нагрузка:
     70% конференций пользователи предпочитают проводить в промежутке с 8 до 12 часов дня:
     $\frac{3160 \times 60 \times 60 \times 150.6  \times 10^{6} \times 0.7   }{14400}  \approx 75400 \text{ ГБит/с}$

2. Просмотр конференции

  - Дневная нагрузка:
     Так как среднее количество участников равно 10:

     $3160 \times 60 \times 60 \times 150.6  \times 10^{6} \times 10    \approx 1.71 \times 10^{16} \ \text{кбит в сутки} \approx 2040 \text{ ПБайт/сутки}$

  - Пиковая нагрузка:

    $\frac{3160 \times 60 \times 60 \times 150.6  \times 10^{6} \times 0.7  \times 10 }{14400} \approx 754000 \text{ ГБит/с}$


3. Отправка сообщений в чат

   - Дневная нагрузка:
     Суточное количество сообщений в чат составляет $\approx$ 1.4 млрд сообщений(из расчета что каждый участник конференции отправит по 4 сообщения).
     Возьмем размер символа 4 байта и среднюю длину сообщения 10 символов. 
     $1.4 \times 10^{9}\times 4 \times 20\approx 5\ \text{Гбайт/сутки}$

   - Пиковая нагрузка:
     Аналогично данным по проведению конференций возьмем, что 70% конференций проходят в промежутке с 8 до 12 часов дня.
     $\frac{1.4 \times 10^{9} \times 0.7 \times 4 \times 20}{14400} \approx 20\ \text{Мбит/с}$


#### Хранилище

В 2023 около 450 000 пользователей имели платную подписку, одной из возможностей которой является хранение записей конференций в облачном хранилище. Возьмем битрейт, высчитанный выше - 3160 Kbps. Допустим что половина из этих пользователей проводит 1 конференцию в день.

Размер записи с учетом средней длительности конференции в 45 минут:
$\frac{3600 \times 45 \times 60}{1000 \times 8} \approx 1200 \text{Мбайт} $

$\frac{1200 \times 225000}{1024} \approx 260000 \text{ Гбайт / сутки} $

#### RPS

Присоединение к конференции
$
\frac{\text{DAU} \times \text{кол-во конференций в день} }{86400} = \frac{350 \times 10^{6} \times  2}{86400} \approx 8100\ \text{RPS}
$

Загрузка чанка конференции
$ \frac{150 \times 10^{6}* 86400 * 10}{86400} \approx 150 \times 10^{7} RPS
$

Отправка сообщений
$\frac{1.4 \times 10^{9}}{86400} \approx 16200 PRS
$

Так как 70% всей нагрузки приходится на промежуток с 8 до 12 часов дня то пиковый RPS будет в 4 раза больше среднесуточного.

| Метрика                                      | Средний RPS | Пиковый RPS |
| -------------------------------------------- | --------  | -------- |
|Присоединение к конференции| 8100             | 32400|
|Загрузка чанка конференции | $10^{7}$         | $4\times10^{7}$|
|Отправка сообщений         | 16200            | 64800 |

  
## Источники
  1. https://www.semrush.com/website/zoom.us/overview/
  2. https://www.searchlogistics.com/learn/statistics/zoom-user-statistics/
  3. https://www.statista.com/statistics/1259936/distribution-of-zoomus-traffic-by-country/
  4. https://www.demandsage.com/zoom-statistics/
  5. https://teamstage.io/zoom-statistics/
   